# Mek Tycoon Two-Environment System Review
**Last Updated:** October 20, 2025

## Directory Structure

You have **three main directories**, but only two are actively used:

### 1. Main Working Directory (PRODUCTION/STAGING)
**Location:** `C:\Users\Ben Meyers\Documents\Mek Tycoon\TYCOON REACT 8-27\mek-tycoon-react`
- **Active Git Repository:** Yes (https://github.com/hugio55/mek-tycoon-react.git)
- **Current Branch:** master
- **Primary Port:** 3100
- **Secondary/Stable Port:** 3200
- **This is your main workspace** - all current development happens here

### 2. Original/Old Directory (DEV)
**Location:** `C:\Users\Ben Meyers\Documents\Mek Tycoon\mek-tycoon-react`
- **Active Git Repository:** Yes (same GitHub repo)
- **Port:** 3100
- **Status:** This appears to be an older version with the original dev deployment
- **Use case:** Likely kept for reference or fallback

### 3. Backup Copy (INACTIVE)
**Location:** `C:\Users\Ben Meyers\Documents\Mek Tycoon\TYCOON REACT 8-27 - Copy\mek-tycoon-react`
- **Active Git Repository:** No (just a file copy)
- **Status:** Snapshot/backup from Aug 30, 2024
- **Use case:** Emergency backup only

---

## Convex Database Deployments

You have **THREE Convex deployments** (not two):

### 1. **rare-dinosaur-331** (OLD DEV)
- **Type:** `dev:rare-dinosaur-331`
- **Project Name:** mek-tycoon
- **Team:** ben-meyers
- **Cloud URL:** https://rare-dinosaur-331.convex.cloud
- **Status:** Original development deployment
- **Used by:** Old `mek-tycoon-react` directory
- **Config file:** `.env.convex` in main directory

### 2. **fabulous-sturgeon-691** (STAGING/PRODUCTION)
- **Type:** `prod:fabulous-sturgeon-691`
- **Project Name:** mek-tycoon-staging
- **Team:** ben-meyers
- **Cloud URL:** https://fabulous-sturgeon-691.convex.cloud
- **Status:** Main production deployment
- **Used by:** Main working directory (when using `.env.local.staging`)
- **Config files:** `.env.local.staging`, `.env.deploy.prod`
- **Vercel:** This is what your Vercel production deployment uses

### 3. **wry-trout-962** (PRODUCTION CLOUD)
- **Type:** `dev:wry-trout-962`
- **Project Name:** mek-tycoon-staging
- **Team:** ben-meyers
- **Cloud URL:** https://wry-trout-962.convex.cloud
- **Status:** Current active deployment for localhost:3100
- **Used by:** Main working directory (current `.env.local`)
- **Config files:** `.env.local`, `.env.production`

---

## Port Configuration

Both main directories use the same port strategy:

### Port 3100 (Primary)
- **Next.js Dev Server:** `npm run dev` → `next dev -p 3100 -H 0.0.0.0`
- **Unified Command:** `npm run dev:all` → Starts both Next.js (3100) + Convex dev
- **Network Access:** Bound to 0.0.0.0 (accessible from network, needed for mobile testing)
- **This is your standard development port**

### Port 3200 (Stable Fallback)
- **Alternative Dev Server:** `npm run dev:stable` → `next dev -p 3200`
- **Use case:** When port 3100 is busy or for running two instances simultaneously

---

## GitHub Repository Setup

### Single Repository
- **URL:** https://github.com/hugio55/mek-tycoon-react.git
- **Both active directories point to the same repo**
- **Account:** hugio55

### Branch Structure
**Local branches:**
- `master` ← Currently active
- `essence-system`
- `essence-system-worktree`

**Remote branches (on GitHub):**
- `origin/master`
- `origin/essence-system`
- `origin/backup-multi-wallet-20251010-171003`

**Key insight:** You're working primarily on `master` branch, with `essence-system` as a feature branch (which was recently merged based on git history).

---

## Environment File Management

Your main working directory has **11 different .env files** for different scenarios:

### Active Environment Files

1. **`.env.local`** (CURRENTLY ACTIVE)
   - Convex: `wry-trout-962` (dev deployment)
   - URL: https://wry-trout-962.convex.cloud
   - **This is what localhost:3100 uses right now**

2. **`.env.local.staging`**
   - Convex: `fabulous-sturgeon-691` (prod deployment)
   - URL: https://fabulous-sturgeon-691.convex.cloud
   - **Use this for staging testing**

3. **`.env.production`**
   - Convex: `wry-trout-962`
   - **Used by Vercel during production builds**
   - **Minimal config (just the URL)**

4. **`.env.deploy.prod`**
   - Convex: `fabulous-sturgeon-691` (prod deployment)
   - **Quick switch file for production deployment**

5. **`.env.convex`**
   - Convex: `rare-dinosaur-331` (old dev)
   - **Legacy deployment reference**

6. **`.env.vercel.production`**
   - Auto-generated by Vercel CLI
   - Points to `fabulous-sturgeon-691`
   - Contains Vercel OIDC tokens and deployment metadata

### Backup Files
- `.env.local.backup` (Sep 30)
- `.env.local.prod.backup` (Oct 19)
- `.env.local.staging-override` (Oct 19)
- `.env.vercel.check` (Oct 19)

### Other Configuration
All .env files include:
- **Blockfrost API** (Cardano blockchain access)
  - API Key: mainnetVVJ62rD2aJxjvDQvsABxGSPy4jtaMAbW
  - URL: https://cardano-mainnet.blockfrost.io/api/v0
- **Website URL:** https://mek.overexposed.io

---

## How Your Current System Works

### Local Development Workflow

**Starting the app:**
```bash
cd "C:\Users\Ben Meyers\Documents\Mek Tycoon\TYCOON REACT 8-27\mek-tycoon-react"
npm run dev:all
```

This runs:
1. Next.js on port 3100
2. Convex dev mode (watches for schema/function changes)
3. Uses `.env.local` → connects to `wry-trout-962` database

**The confusion point:** Even though your local `.env.local` says `CONVEX_DEPLOYMENT=dev:wry-trout-962`, the actual deployment type is "dev" which means it's a development deployment on Convex Cloud (not truly "production" in Convex terms).

### Switching Between Environments

**To use STAGING database:**
```bash
# Rename files
mv .env.local .env.local.current
mv .env.local.staging .env.local
npm run dev:all
```

**To use PRODUCTION database:**
Already using it with current `.env.local` (wry-trout-962)

### Production Deployment (Vercel)

**Website:** https://mek.overexposed.io

**Deployment flow:**
1. You push code to GitHub (master branch)
2. Vercel auto-deploys from master
3. Vercel uses environment variables configured in Vercel dashboard
4. Based on `.env.vercel.production`, production uses `fabulous-sturgeon-691`

**Recent deployment commits:**
- 4fcd18f6: "Force new bundle hash - add build timestamp"
- 7574a543: "Force cache bust - update to fabulous-sturgeon-691"
- 7d77b39f: "Add .env.production with correct Convex URL"

---

## Issues & Observations

### 1. Deployment Type Confusion
**Problem:** Your "production" database `wry-trout-962` is marked as `dev:` type, not `prod:` type.

**Explanation:**
- `dev:` = Convex development deployment (has dev tools, can reset)
- `prod:` = Convex production deployment (protected, requires manual schema migrations)

**What this means:**
- `fabulous-sturgeon-691` = True production (type: `prod:`)
- `wry-trout-962` = Development deployment on cloud (type: `dev:`)

**Your Vercel production actually uses `fabulous-sturgeon-691`**, not `wry-trout-962`.

### 2. Multiple Environment Files
You have 11 .env files, which can cause confusion about which is active. Git ignores all `.env*` files, so this state isn't version-controlled.

**Current active file:** `.env.local` (modified Oct 19 23:34)

### 3. Three Deployments Instead of Two
You mentioned "2 databases" but actually have 3:
- `rare-dinosaur-331` (legacy, probably should be deleted)
- `fabulous-sturgeon-691` (actual production, used by Vercel)
- `wry-trout-962` (development cloud, used by localhost:3100)

### 4. Directory Duplication
You have two active git directories pointing to the same repo, which could cause sync issues:
- `TYCOON REACT 8-27\mek-tycoon-react` (main)
- `mek-tycoon-react` (old, different Convex deployment)

---

## Recommendations

### Clarify Your Environment Strategy

**Option A: True Staging + Production**
- **STAGING:** Use `wry-trout-962` for testing before production
- **PRODUCTION:** Use `fabulous-sturgeon-691` for live site
- Delete `rare-dinosaur-331` (legacy)

**Option B: Single Production**
- Use only `fabulous-sturgeon-691`
- Delete both `rare-dinosaur-331` and `wry-trout-962`
- Simpler, less confusion

### Clean Up Directories
- Archive or delete `C:\Users\Ben Meyers\Documents\Mek Tycoon\mek-tycoon-react` (old directory)
- Keep `TYCOON REACT 8-27 - Copy` as emergency backup only
- Work exclusively from `TYCOON REACT 8-27\mek-tycoon-react`

### Simplify Environment Files
Create clear naming:
- `.env.local` → Local development
- `.env.staging` → Staging environment (if keeping wry-trout-962)
- `.env.production` → Production environment (fabulous-sturgeon-691)

Delete backup files and maintain them in git instead using branches.

---

## Current State Summary

**Your localhost:3100 currently connects to:**
- Convex: `dev:wry-trout-962`
- URL: https://wry-trout-962.convex.cloud

**Your production site (mek.overexposed.io) connects to:**
- Convex: `prod:fabulous-sturgeon-691`
- URL: https://fabulous-sturgeon-691.convex.cloud

**Working directory:**
- `C:\Users\Ben Meyers\Documents\Mek Tycoon\TYCOON REACT 8-27\mek-tycoon-react`

**GitHub:**
- Single repo: hugio55/mek-tycoon-react
- Current branch: master

**Ports:**
- Primary: 3100 (Next.js + Convex)
- Fallback: 3200 (Next.js only)

---

## Quick Reference for Future Sessions

**To get caught up, tell Claude:**
> "Please read ENVIRONMENT_SETUP_REVIEW.md to understand my two-environment system setup."

**Key files to check when debugging environment issues:**
- `.env.local` - Current active environment
- `.env.local.staging` - Staging environment config
- `package.json` - Port configurations
- Git status - Which branch you're on
