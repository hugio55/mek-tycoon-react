<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas Test for Fireworks Issues</title>
    <style>
        body {
            background: #000;
            color: white;
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        #test-canvas {
            border: 1px solid #333;
            display: block;
            margin: 20px 0;
            cursor: crosshair;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            background: #222;
            border-radius: 5px;
        }
        .error { background: #440000; }
        .success { background: #004400; }
        .warning { background: #444400; }
    </style>
</head>
<body>
    <h1>Fireworks Page Issue Diagnostics</h1>
    
    <div id="diagnostics"></div>
    
    <h2>Canvas Test</h2>
    <p>Click on the canvas below to test firework launching:</p>
    <canvas id="test-canvas" width="800" height="400"></canvas>
    
    <div id="click-log"></div>

    <script>
        const diagnostics = document.getElementById('diagnostics');
        const clickLog = document.getElementById('click-log');
        const canvas = document.getElementById('test-canvas');
        const ctx = canvas.getContext('2d');
        
        let clickCount = 0;
        
        function addStatus(message, type = '') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = message;
            diagnostics.appendChild(div);
        }
        
        function addClickLog(message) {
            const div = document.createElement('div');
            div.innerHTML = message;
            clickLog.appendChild(div);
            if (clickLog.children.length > 5) {
                clickLog.removeChild(clickLog.firstChild);
            }
        }
        
        // Test basic canvas functionality
        addStatus('Testing Canvas Functionality...', 'warning');
        
        try {
            // Test canvas dimensions
            if (canvas.width > 0 && canvas.height > 0) {
                addStatus(`✅ Canvas dimensions: ${canvas.width} x ${canvas.height}`, 'success');
            } else {
                addStatus(`❌ Invalid canvas dimensions: ${canvas.width} x ${canvas.height}`, 'error');
            }
            
            // Test 2D context
            if (ctx) {
                addStatus('✅ 2D context retrieved successfully', 'success');
            } else {
                addStatus('❌ Failed to get 2D context', 'error');
            }
            
            // Test drawing capability
            ctx.fillStyle = '#444';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw some test stars
            ctx.fillStyle = '#fff';
            for (let i = 0; i < 20; i++) {
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height * 0.6;
                ctx.fillRect(x, y, 2, 2);
            }
            
            addStatus('✅ Basic drawing successful - stars should be visible', 'success');
            
            // Add click handler
            canvas.addEventListener('click', (e) => {
                clickCount++;
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                addClickLog(`Click #${clickCount}: (${Math.round(x)}, ${Math.round(y)})`);
                
                // Draw a simple "firework" at click location
                ctx.fillStyle = '#ff0';
                ctx.beginPath();
                ctx.arc(x, y, 20, 0, Math.PI * 2);
                ctx.fill();
                
                // Draw radiating particles
                ctx.fillStyle = '#f80';
                for (let i = 0; i < 16; i++) {
                    const angle = (Math.PI * 2 / 16) * i;
                    const dx = Math.cos(angle) * 30;
                    const dy = Math.sin(angle) * 30;
                    ctx.fillRect(x + dx - 1, y + dy - 1, 2, 2);
                }
            });
            
            addStatus('✅ Click handler attached successfully', 'success');
            
        } catch (error) {
            addStatus(`❌ JavaScript Error: ${error.message}`, 'error');
        }
        
        // Test potential issues from the original fireworks code
        addStatus('Testing Original Code Issues...', 'warning');
        
        // Check if DOM elements exist as expected
        const checkElements = [
            { id: 'fireworks-canvas', name: 'Fireworks Canvas' },
            { id: 'stars-canvas', name: 'Stars Canvas' },
            { id: 'reflection-canvas', name: 'Reflection Canvas' },
            { id: 'enter-btn', name: 'Enter Button' }
        ];
        
        // These won't exist in this test page, but we're checking the pattern
        addStatus('Elements that should exist in main page:', '');
        checkElements.forEach(el => {
            const exists = document.getElementById(el.id) !== null;
            addStatus(`${exists ? '✅' : '❓'} ${el.name} (${el.id})`, exists ? 'success' : '');
        });
        
        addStatus('Common Issues to Check in Main Page:', 'warning');
        addStatus('1. Canvas z-index conflicts preventing clicks', '');
        addStatus('2. Canvas not properly sized after resize', '');
        addStatus('3. Canvas cleared before drawing', '');
        addStatus('4. Animation loop not running', '');
        addStatus('5. JavaScript errors preventing execution', '');
        
    </script>
</body>
</html>