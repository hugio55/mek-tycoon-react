<!DOCTYPE html>
<html>
<head>
    <title>Check Story Saves</title>
    <style>
        body {
            font-family: monospace;
            background: #111;
            color: #0f0;
            padding: 20px;
        }
        pre {
            background: #000;
            padding: 15px;
            border: 1px solid #0f0;
            overflow: auto;
        }
        button {
            background: #0f0;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-family: monospace;
            font-weight: bold;
        }
        button:hover {
            background: #0a0;
        }
    </style>
</head>
<body>
    <h1>Story Mode Saves Checker</h1>
    <div>
        <button onclick="checkSaves()">Check Current Saves</button>
        <button onclick="addTest2()">Add Test 2 Save</button>
        <button onclick="clearSaves()">Clear All Saves</button>
    </div>
    <pre id="output"></pre>
    
    <script>
        function checkSaves() {
            const saves = localStorage.getItem('savedStoryModes');
            const output = document.getElementById('output');
            
            if (saves) {
                try {
                    const parsed = JSON.parse(saves);
                    output.textContent = '✅ Found saved story modes:\n\n';
                    parsed.forEach((save, i) => {
                        output.textContent += `[${i}] Name: ${save.name}\n`;
                        output.textContent += `    Chapter: ${save.chapter}\n`;
                        output.textContent += `    Nodes: ${save.data.nodes.length}\n`;
                        output.textContent += `    Connections: ${save.data.connections.length}\n\n`;
                    });
                    output.textContent += '\n\nFull data:\n' + JSON.stringify(parsed, null, 2);
                } catch (e) {
                    output.textContent = '❌ Error parsing saves: ' + e.message;
                }
            } else {
                output.textContent = '❌ No saved story modes found in localStorage';
            }
        }
        
        function addTest2() {
            const test2Data = {
                name: "test 2",
                chapter: 2,
                data: {
                    nodes: [
                        { id: 'start', x: 0, y: 100, label: 'START', storyNodeType: 'normal' },
                        { id: 'node-1', x: -200, y: 250, label: 'Scout Path', storyNodeType: 'normal' },
                        { id: 'node-2', x: 0, y: 250, label: 'Main Path', storyNodeType: 'normal' },
                        { id: 'node-3', x: 200, y: 250, label: 'Risk Path', storyNodeType: 'event' },
                        { id: 'node-4', x: -250, y: 400, label: 'Hidden Cache', storyNodeType: 'event' },
                        { id: 'node-5', x: -100, y: 400, label: 'Ambush Point', storyNodeType: 'normal' },
                        { id: 'node-6', x: 100, y: 400, label: 'Stronghold', storyNodeType: 'normal' },
                        { id: 'node-7', x: 250, y: 400, label: 'Elite Guard', storyNodeType: 'boss' },
                        { id: 'node-8', x: -200, y: 550, label: 'Supply Route', storyNodeType: 'normal' },
                        { id: 'node-9', x: -50, y: 550, label: 'Command Post', storyNodeType: 'normal' },
                        { id: 'node-10', x: 50, y: 550, label: 'Weapons Cache', storyNodeType: 'event' },
                        { id: 'node-11', x: 200, y: 550, label: 'Boss Arena', storyNodeType: 'boss' },
                        { id: 'node-12', x: -150, y: 700, label: 'Rally Point', storyNodeType: 'normal' },
                        { id: 'node-13', x: 0, y: 700, label: 'Central Hub', storyNodeType: 'event' },
                        { id: 'node-14', x: 150, y: 700, label: 'Final Prep', storyNodeType: 'normal' },
                        { id: 'node-15', x: -100, y: 850, label: 'Twin Guards', storyNodeType: 'boss' },
                        { id: 'node-16', x: 100, y: 850, label: 'War Machine', storyNodeType: 'boss' },
                        { id: 'node-17', x: -150, y: 1000, label: 'Secret Path', storyNodeType: 'event' },
                        { id: 'node-18', x: 0, y: 1000, label: 'Main Gate', storyNodeType: 'normal' },
                        { id: 'node-19', x: 150, y: 1000, label: 'Side Entry', storyNodeType: 'normal' },
                        { id: 'node-20', x: 0, y: 1150, label: 'Overlord', storyNodeType: 'final_boss' }
                    ],
                    connections: [
                        { from: 'start', to: 'node-1' },
                        { from: 'start', to: 'node-2' },
                        { from: 'start', to: 'node-3' },
                        { from: 'node-1', to: 'node-4' },
                        { from: 'node-1', to: 'node-5' },
                        { from: 'node-2', to: 'node-5' },
                        { from: 'node-2', to: 'node-6' },
                        { from: 'node-3', to: 'node-6' },
                        { from: 'node-3', to: 'node-7' },
                        { from: 'node-4', to: 'node-8' },
                        { from: 'node-5', to: 'node-8' },
                        { from: 'node-5', to: 'node-9' },
                        { from: 'node-6', to: 'node-9' },
                        { from: 'node-6', to: 'node-10' },
                        { from: 'node-7', to: 'node-10' },
                        { from: 'node-7', to: 'node-11' },
                        { from: 'node-8', to: 'node-12' },
                        { from: 'node-9', to: 'node-12' },
                        { from: 'node-9', to: 'node-13' },
                        { from: 'node-10', to: 'node-13' },
                        { from: 'node-10', to: 'node-14' },
                        { from: 'node-11', to: 'node-14' },
                        { from: 'node-12', to: 'node-15' },
                        { from: 'node-13', to: 'node-15' },
                        { from: 'node-13', to: 'node-16' },
                        { from: 'node-14', to: 'node-16' },
                        { from: 'node-15', to: 'node-17' },
                        { from: 'node-15', to: 'node-18' },
                        { from: 'node-16', to: 'node-18' },
                        { from: 'node-16', to: 'node-19' },
                        { from: 'node-17', to: 'node-20' },
                        { from: 'node-18', to: 'node-20' },
                        { from: 'node-19', to: 'node-20' }
                    ]
                }
            };
            
            let saves = [];
            const existing = localStorage.getItem('savedStoryModes');
            if (existing) {
                try {
                    saves = JSON.parse(existing);
                    // Remove any existing "test 2" to avoid duplicates
                    saves = saves.filter(s => s.name.toLowerCase() !== 'test 2');
                } catch (e) {
                    console.error('Error parsing existing saves:', e);
                }
            }
            
            // Add test 2 at the beginning
            saves.unshift(test2Data);
            localStorage.setItem('savedStoryModes', JSON.stringify(saves));
            
            document.getElementById('output').textContent = '✅ Added "test 2" save successfully!\n\nRefresh the story-climb page to see it.';
            
            // Also check the saves after adding
            setTimeout(checkSaves, 100);
        }
        
        function clearSaves() {
            if (confirm('Are you sure you want to clear all story saves?')) {
                localStorage.removeItem('savedStoryModes');
                document.getElementById('output').textContent = '✅ Cleared all story saves';
            }
        }
        
        // Check on load
        checkSaves();
    </script>
</body>
</html>