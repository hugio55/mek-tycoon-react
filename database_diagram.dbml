// Mek Tycoon Database Schema for dbdiagram.io
// Generated from Convex schema.ts

Table meks {
  _id varchar [pk, note: 'Convex auto-generated ID']
  assetId varchar [unique, not null]
  assetName varchar [not null]
  owner varchar [not null, note: 'wallet address']
  iconUrl varchar
  verified boolean [not null, note: 'blockchain verified']
  sourceKey varchar [note: 'Full source key from metadata']
  sourceKeyBase varchar [note: 'Source key without suffix']
  
  // Visual attributes
  headGroup varchar
  headVariation varchar [not null]
  headVariationId integer [ref: > variationsReference.variationId]
  bodyGroup varchar
  bodyVariation varchar [not null]
  bodyVariationId integer [ref: > variationsReference.variationId]
  armsGroup varchar
  armsVariation varchar
  legsGroup varchar
  legsVariation varchar
  boosterGroup varchar
  boosterVariation varchar
  itemGroup varchar
  itemVariation varchar
  itemVariationId integer [ref: > variationsReference.variationId]
  
  // Game stats
  level integer
  experience integer
  health integer
  maxHealth integer
  speed integer
  
  // Rarity and ranking
  rarityRank integer [note: 'Original CNFT marketplace ranking']
  gameRank integer [note: 'Custom game ranking']
  cnftRank integer
  isGenesis boolean
  rarityTier varchar
  powerScore integer
  
  // Battle data
  wins integer
  losses integer
  draws integer
  winStreak integer
  
  // Economic data
  scrapValue integer
  marketValue integer
  lastSalePrice integer
  
  // Special attributes
  abilities varchar[]
  traits varchar[]
  specialMove varchar
  
  // Metadata
  lastUpdated timestamp
  inBattle boolean
  isStaked boolean
  
  indexes {
    owner
    assetId
    assetName
    sourceKey
    sourceKeyBase
    headVariation
    bodyVariation
    rarityTier
    powerScore
    level
  }
}

Table users {
  _id varchar [pk, note: 'Convex auto-generated ID']
  
  // Cardano Wallet Authentication
  walletAddress varchar [unique, not null]
  walletName varchar
  walletStakeAddress varchar
  walletVerified boolean
  walletType varchar
  
  // Profile fields
  username varchar
  avatar varchar
  bio varchar
  
  // Game resources
  totalEssence_stone integer [not null]
  totalEssence_disco integer [not null]
  totalEssence_paul integer [not null]
  totalEssence_cartoon integer [not null]
  totalEssence_candy integer [not null]
  totalEssence_tiles integer [not null]
  totalEssence_moss integer [not null]
  totalEssence_bullish integer [not null]
  totalEssence_journalist integer [not null]
  totalEssence_laser integer [not null]
  totalEssence_flashbulb integer [not null]
  totalEssence_accordion integer [not null]
  totalEssence_turret integer [not null]
  totalEssence_drill integer [not null]
  totalEssence_security integer [not null]
  
  gold integer [not null]
  craftingSlots integer [not null]
  
  // Gold generation tracking
  goldPerHour integer
  lastGoldCollection timestamp
  pendingGold integer
  
  // User stats
  level integer
  experience integer
  totalBattles integer
  totalWins integer
  winRate float
  
  // Timestamps
  lastLogin timestamp [not null]
  createdAt timestamp
  updatedAt timestamp
  
  // Status
  isOnline boolean
  isBanned boolean
  role user_role
  
  indexes {
    walletAddress
    walletStakeAddress
    username
  }
}

Table variationsReference {
  _id varchar [pk]
  variationId integer [unique, not null]
  name varchar [not null]
  type variation_type [not null]
  baseXp integer
  copies integer
  
  indexes {
    variationId
    type
    name
  }
}

Table craftingRecipes {
  _id varchar [pk]
  name varchar [not null]
  outputType output_type [not null]
  outputVariation varchar [not null]
  outputVariationId integer [ref: > variationsReference.variationId]
  essenceCost_stone integer
  essenceCost_disco integer
  essenceCost_paul integer
  essenceCost_cartoon integer
  essenceCost_candy integer
  essenceCost_tiles integer
  essenceCost_moss integer
  essenceCost_bullish integer
  essenceCost_journalist integer
  essenceCost_laser integer
  essenceCost_flashbulb integer
  essenceCost_accordion integer
  essenceCost_turret integer
  essenceCost_drill integer
  essenceCost_security integer
  goldCost integer
  cooldownMinutes integer [not null]
  successRate integer [not null, note: '0-100']
  unlockRequirement varchar
  
  indexes {
    outputType
    name
  }
}

Table craftingSessions {
  _id varchar [pk]
  userId varchar [ref: > users._id, not null]
  recipeId varchar [ref: > craftingRecipes._id, not null]
  startedAt timestamp [not null]
  completesAt timestamp [not null]
  status crafting_status [not null]
  slotNumber integer [not null]
  
  indexes {
    userId
    status
    completesAt
  }
}

Table inventory {
  _id varchar [pk]
  userId varchar [ref: > users._id, not null]
  itemType item_type [not null]
  itemVariation varchar [not null]
  quantity integer [not null]
  craftedAt timestamp [not null]
  
  indexes {
    userId
    itemType
  }
}

Table marketListings {
  _id varchar [pk]
  sellerId varchar [ref: > users._id, not null]
  itemType market_item_type [not null]
  itemVariation varchar
  itemDescription varchar
  mekId varchar [ref: > meks._id]
  essenceType varchar
  quantity integer [not null]
  pricePerUnit integer [not null]
  imageUrl varchar
  listedAt timestamp [not null]
  expiresAt timestamp
  status listing_status [not null]
  isAdminListing boolean
  
  indexes {
    sellerId
    status
    itemType
    pricePerUnit
  }
}

Table transactions {
  _id varchar [pk]
  type transaction_type [not null]
  userId varchar [ref: > users._id, not null]
  amount integer
  itemType varchar
  itemVariation varchar
  details varchar
  timestamp timestamp [not null]
  
  indexes {
    userId
    type
    timestamp
  }
}

Table achievements {
  _id varchar [pk]
  userId varchar [ref: > users._id, not null]
  achievementId varchar [not null]
  unlockedAt timestamp [not null]
  progress integer
  
  indexes {
    userId
    achievementId
  }
}

Table buffTypes {
  _id varchar [pk]
  name varchar [not null]
  description varchar [not null]
  buffType buff_type [not null]
  valueType value_type [not null]
  baseValue float [not null]
  maxStacks integer [not null]
  icon varchar
  rarity buff_rarity [not null]
  
  indexes {
    buffType
    rarity
  }
}

Table activeBuffs {
  _id varchar [pk]
  userId varchar [ref: > users._id, not null]
  buffTypeId varchar [ref: > buffTypes._id, not null]
  source varchar [not null]
  sourceId varchar
  value float [not null]
  stacks integer [not null]
  startedAt timestamp [not null]
  expiresAt timestamp
  isActive boolean [not null]
  
  indexes {
    userId
    (userId, isActive)
    expiresAt
    buffTypeId
  }
}

Table bankAccounts {
  _id varchar [pk]
  userId varchar [ref: - users._id, not null, unique]
  balance float [not null]
  interestRate float [not null]
  lastInterestPaid timestamp [not null]
  totalDeposited float [not null]
  totalWithdrawn float [not null]
  totalInterestEarned float [not null]
  createdAt timestamp [not null]
  accountLevel varchar
  isLocked boolean
  maxLoanAmount float
  
  indexes {
    userId
  }
}

Table stockCompanies {
  _id varchar [pk]
  symbol varchar [unique, not null]
  name varchar [not null]
  currentPrice float [not null]
  previousClose float [not null]
  dayHigh float [not null]
  dayLow float [not null]
  volume float [not null]
  marketCap float [not null]
  volatility float [not null, note: '0.1 to 1.0']
  trend float [not null, note: '-1 to 1']
  lastUpdated timestamp [not null]
  
  indexes {
    symbol
  }
}

Table stockPriceHistory {
  _id varchar [pk]
  companyId varchar [ref: > stockCompanies._id, not null]
  symbol varchar [not null]
  timestamp timestamp [not null]
  open float [not null]
  high float [not null]
  low float [not null]
  close float [not null]
  volume float [not null]
  period price_period [not null]
  sunspots integer
  
  indexes {
    companyId
    (symbol, timestamp)
    period
  }
}

Table stockHoldings {
  _id varchar [pk]
  userId varchar [ref: > users._id, not null]
  companyId varchar [ref: > stockCompanies._id, not null]
  symbol varchar [not null]
  shares float [not null]
  averageCost float [not null]
  totalInvested float [not null]
  currentValue float [not null]
  realizedProfitLoss float [not null]
  lastUpdated timestamp [not null]
  
  indexes {
    userId
    (userId, companyId)
    symbol
  }
}

Table stockTransactions {
  _id varchar [pk]
  userId varchar [ref: > users._id, not null]
  companyId varchar [ref: > stockCompanies._id, not null]
  symbol varchar [not null]
  type stock_transaction_type [not null]
  shares float [not null]
  pricePerShare float [not null]
  totalAmount float [not null]
  timestamp timestamp [not null]
  
  indexes {
    userId
    companyId
    timestamp
  }
}

Table bankTransactions {
  _id varchar [pk]
  userId varchar [ref: > users._id, not null]
  type bank_transaction_type [not null]
  amount float [not null]
  balanceBefore float [not null]
  balanceAfter float [not null]
  description varchar
  relatedId varchar
  timestamp timestamp [not null]
  status transaction_status [not null]
  
  indexes {
    userId
    type
    timestamp
    status
  }
}

Table interestRates {
  _id varchar [pk]
  productType varchar [not null]
  accountLevel varchar
  baseRate float [not null]
  bonusRate float
  minAmount float
  maxAmount float
  effectiveFrom timestamp [not null]
  effectiveTo timestamp
  isActive boolean [not null]
  
  indexes {
    productType
    isActive
    effectiveFrom
  }
}

Table sunspotData {
  _id varchar [pk]
  date varchar [not null, note: 'YYYY-MM-DD']
  count integer [not null]
  timestamp timestamp [not null]
  
  indexes {
    date
    timestamp
  }
}

Table solarFlares {
  _id varchar [pk]
  date varchar [not null, note: 'YYYY-MM-DD']
  timestamp timestamp [not null]
  class varchar [not null, note: 'A, B, C, M, X']
  peakTime varchar [not null]
  intensity float
  region integer
  
  indexes {
    date
    timestamp
    class
  }
}

// Enum definitions
Enum user_role {
  user
  moderator
  admin
}

Enum variation_type {
  head
  body
  item
}

Enum output_type {
  head
  body
  trait
}

Enum crafting_status {
  crafting
  completed
  claimed
  failed
}

Enum item_type {
  head
  body
  trait
}

Enum market_item_type {
  essence
  head
  body
  trait
  overexposed
  consumable
  boost
  special
}

Enum listing_status {
  active
  sold
  cancelled
  expired
}

Enum transaction_type {
  craft
  purchase
  sale
  essence_convert
  reward
}

Enum buff_type {
  gold_rate
  xp_gain
  auction_fee_reduction
  essence_rate
  crafting_speed
  crafting_success
  slot_bonus
  market_discount
  essence_efficiency
  gold_capacity
}

Enum value_type {
  flat
  percentage
}

Enum buff_rarity {
  common
  uncommon
  rare
  epic
  legendary
}

Enum price_period {
  "1m"
  "5m"
  "1h"
  "1d"
}

Enum stock_transaction_type {
  buy
  sell
}

Enum bank_transaction_type {
  deposit
  withdraw
  loan_disbursement
  loan_payment
  interest_payment
  investment_purchase
  investment_redemption
  dividend_payment
  fee
  transfer_in
  transfer_out
}

Enum transaction_status {
  completed
  pending
  failed
  reversed
}